GrapheneDataGrid=function(e){"object"==typeof e.collections?this.collections=e.collections:this.collections=gform.collections,this.methods=e.methods||{};var t=[{type:"danger",name:"delete",min:1,label:'<i class="fa fa-times"></i> Delete'},"|",{type:"primary",name:"edit",min:1,label:'<i class="fa fa-pencil"></i> Edit'},"|",{type:"success",name:"create",min:0,label:'<i class="fa fa-pencil-square-o"></i> New'}];this.resource=e.resource,this.eventBus=new gform.eventBus({owner:"grid",item:"model",handlers:e.events||{}},this),this.on=this.eventBus.on,this.trigger=this.eventBus.dispatch,"object"==typeof(e=_.extend({filter:!0,actions:[{name:"create"},"|",{name:"edit"},"|",{name:"delete"}],sort:!0,search:!0,download:!0,upload:!0,columns:!0,id:gform.getUID()},e)).actions&&e.actions.length?e.actions=_.map(e.actions,(function(e){var i=_.find(t,{name:e.name});return void 0!==i&&(e=_.defaultsDeep(e,i)),e})):e.actions=!1;var i=!1;if(window.localStorage&&e.name)try{i=JSON.parse(localStorage.getItem("bt_"+e.name))}catch(e){}"string"!=typeof e.item_template&&(window.outerWidth>767||0==window.outerWidth?e.item_template=gform.stencils.table_row:(this.mobile=!0,e.item_template=gform.stencils.mobile_row)),this.toJSON=function(){return _.pluck(this.getModels(),"attributes")},this.filterValues={},this.draw=function(){_.each(this.summary.items,function(e){this.$el.find(".filter #"+e.id+",[data-sort="+e.id+"]").toggle(e.isEnabled)}.bind(this)),e.search=this.filterValues,_.each(e.search,(function(t,i){t||0===t||delete e.search[i]}));var t=e.pagebuffer||2;this.$el.find('[name="search"]').length&&this.$el.find('[name="search"]').val().length?this.searchAll(this.$el.find('[name="search"]').val()):this.search(e);var i={};e.pagecount=Math.ceil(this.lastGrabbed/e.count),i.pages=[],e.page>e.pagecount&&(e.page=e.pagecount||1);var s=this.lastGrabbed>e.count*e.page?e.count*e.page:this.lastGrabbed,n=document.createDocumentFragment();_.each(this.grab(e),(function(e){n.appendChild(e.draw())}));var a=this.$el[0].querySelector(".list-group");null!==a&&(a.innerHTML="",a.appendChild(n));var o=e.page-t;o<1&&(o=1);var r=e.page+t;r>e.pagecount&&(r=e.pagecount);for(var l=o;l<=r;l++){var d={name:l};e.page==l&&(d.active="active"),i.pages.push(d)}i.size=this.lastGrabbed,i.last=s,i.first=e.count*(e.page-1)+1,i.multiPage=r>o,i.isFirst=1==e.page,i.isLast=e.page==e.pagecount,i.showLast=e.pagecount==r,i.showFirst=1==o,i.checked_count=this.getSelected().length,i.entries=_.map(e.entries,(function(t){return{value:t,selected:t==e.count}}),e),this.renderObj=i,this.updateCount(),this.$el.find(".paginate-footer").html(gform.render("table_footer",this.renderObj)),this.fixStyle(),window.localStorage&&e.name&&localStorage.setItem("bt_"+e.name,JSON.stringify(this.state.get()))};var s=function(t){switch(t.stopPropagation(),t.currentTarget.dataset.page){case"inc":e.page++,e.page>e.pagecount&&(e.page=e.pagecount);break;case"dec":e.page--,e.page<1&&(e.page=1);break;default:e.page=t.currentTarget.dataset.page||e.pagecount}this.draw()},n=function(t,i){if(void 0===t||1==t)this.$el.find(".reverse, [data-sort]").removeClass("text-primary").find("i").attr("class","fa fa-sort text-muted"),this.$el.find(".sortBy").val("true"),e.reverse=!1;else{void 0===i?e.sort==t?e.reverse=!e.reverse:e.reverse=!1:e.reverse=i;var s=this.$el.find(".reverse, [data-sort="+_.find(this.options.filterFields,{search:t}).id+"]");void 0!==s&&(e.reverse?s.find("i").attr("class","fa fa-sort-asc"):s.find("i").attr("class","fa fa-sort-desc"),s.siblings("[data-sort]").removeClass("text-primary"),s.siblings("[data-sort]").find("i").attr("class","fa fa-sort text-muted"),s.addClass("text-primary"))}e.sort=t,this.draw()}.bind(this);(e=_.extend({count:e.count||25,page:1,sort:"createdAt",reverse:!1},e)).schema=e.schema||e.form.fields,e.filterFields=_.map(_.extend({},e.schema),(function(e){switch(e=_.omit(gform.normalizeField.call({options:{default:{type:"text"}}},e),"parent","columns"),name=e.name,e.value="",e.type){case"checkbox":e.format={label:"{{label}}"};var t=new gform.mapOptions(e);e.options=t.getoptions(),e.options=_.defaults(e.options,[{label:"False",value:"false"},{label:"True",value:"true"}]);case"radio":e.type="select";case"select":e.placeholder=!1,e.multiple=!1;t=_.pick(e,["options","max","min","path","format"]);e=_.omit(e,["options","max","min","path","format"]),t.type="optgroup",e.options=[{type:"optgroup",options:[{label:"No Filter",value:""}],format:{label:"{{label}}"}},t];break;case"fieldset":e.type="text",e.template||(e.template=_.map(e.fields,(function(t){return"{{attributes."+e.name+"."+t.name+"}}"})),e.template=e.template.join("<br>")),e=_.omit(e,["fields"]);break;case"smallcombo":case"hidden":break;default:e.type="text"}return e.options&&"object"==typeof e.options&&(e.options=_.map(e.options,(function(e){return"object"==typeof e?_.omit(e,"selected"):e}))),e.id=e.id||gform.getUID(),e.search=e.name,e.name=e.id,e.show=[],e.edit=[],e.show=[],delete e.delete,delete e.size,e.edit=!0,e.help="",e.array=!1,e})),"object"==typeof e.columns&&(e.filterFields=_.filter(e.filterFields,(function(t){return _.includes(e.columns,t.name)||_.includes(e.columns,t.id)})));var a,o={"[[":"{{","]]":"}}",checked_count:0,items:_.map(e.filterFields,(function(e){var t=e.search||e.label.split(" ").join("_").toLowerCase();return t=e.template?e.template:"{{display."+t+"}}",{isEnabled:void 0===e.showColumn||e.showColumn,label:e.label,name:t,cname:e.name||e.label.split(" ").join("_").toLowerCase(),id:e.id,visible:!("hidden"==e.type)}}))};e.entries=e.entries||[25,50,100],o.options=e,this.summary=o,a=e.template?a=gform.renderString(e.template,o):this.mobile?gform.render("mobile_table",o):gform.render("table",o);t={create:function(){var t=e.schema;"object"==typeof e.create&&(t=e.create.fields),new gform({name:"modal",data:e.defaultData,table:this,collections:this.collections,methods:this.methods,events:(e.create||e.form||{}).events,actions:[{type:"cancel",modifiers:"btn btn-danger pull-left"},{type:"save"},{type:"hidden",name:"_method",value:"create",parse:function(){return!1}}],legend:'<i class="fa fa-pencil-square-o"></i> Create New',fields:t}).on("save",function(e){e.form.validate(!0)&&(this.add(e.form.get(),{validate:!1}),e.form.trigger("close"))}.bind(this)).on("cancel",(function(e){e.form.trigger("close")})).modal()},edit:function(){if(this.getSelected().length>1){if(void 0===this.options.multiEdit||0==this.options.multiEdit.length)return;var t=this.getSelected();if(0==t.length)return;var i=_.map(t,(function(e){return e.attributes})),s=_.filter(this.options.multiEdit,(function(e){return 1==_.uniq(_.map(i,e)).length})),n=_.filter(this.options.schema,(function(e){return s.indexOf(e.name)>=0}));n.length>0?new gform({collections:this.collections,methods:this.methods,events:(e.edit||e.form||{}).events,legend:"("+t.length+") Common Field Editor",actions:[{type:"cancel",modifiers:"btn btn-danger pull-left"},{type:"save"},{type:"hidden",name:"_method",value:"edit",parse:function(){return!1}}],fields:n,data:_.extend({},_.pick(t[0].attributes,s))}).on("save",(function(e){if(e.form.validate(!0)){var i=e.form.get();_.map(t,function(e){e.update(i),this.eventBus.dispatch("model:edited",e)}.bind(this)),e.form.trigger("close")}})).on("close",function(){this.draw(),this.eventBus.dispatch("edited")}.bind(this)).on("cancel",(function(e){e.form.trigger("close")})).modal():$(gform.render("modal_container",{title:"Common Field Editor ",footer:'<div class="btn btn-danger" style="margin-right:20px" data-dismiss="modal">Done</div>',body:'<div class="alert alert-warning">No eligible fields have been found for editing.</div>'})).modal()}else{var a=e.schema;"object"==typeof e.edit&&(a=e.edit.fields),new gform({collections:this.collections,methods:this.methods,events:(e.edit||e.form||{}).events,name:"modal",actions:[{type:"cancel",modifiers:"btn btn-danger pull-left"},{type:"save"},{type:"hidden",name:"_method",value:"edit",parse:function(){return!1}}],legend:'<i class="fa fa-pencil-square-o"></i> Edit',data:this.getSelected()[0].attributes,fields:a}).on("save",function(e){e.form.validate(!0)&&(this.getSelected()[0].set(_.extend({},this.getSelected()[0].attributes,e.form.toJSON())),this.eventBus.dispatch("edited"),this.eventBus.dispatch("model:edited",this.getSelected()[0]),this.draw(),e.form.trigger("close"))}.bind(this)).on("cancel",(function(e){e.form.trigger("close")})).modal()}},delete:function(){var e=this.getSelected();e.length&&confirm("Are you sure you want to delete "+e.length+" records? \nThis operation can not be undone.\n\n")&&(_.each(e,function(e){e.delete(),this.eventBus.dispatch("model:deleted",e)}.bind(this)),this.eventBus.dispatch("deleted"),this.draw())},mark:function(e){e.model.toggle()}};function r(t,i){var s,n,a=this.files;window.FileReader?(s=a[0],(n=new FileReader).readAsText(s),n.onload=function(i){var s=i.target.result,n=_.csvToArray(s),a=!0,o=$(gform.render("modal_container",{title:"Importing CSV ",footer:'<div class="btn btn-danger" data-dismiss="modal">Cancel</div>',body:'<div class="progress"><div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="width: 0%"><span class="sr-only">50% Complete</span></div></div><div class="status">Validating Items...</div>'}));o.modal(),o.on("hidden.bs.modal",function(){this.importing=!1}.bind(this));var r=n.length-1,l=2*r,d=[];this.importing=!0,n[0]=_.map(n[0],(function(t){var i=_.find(e.schema,{label:t});return i=null==i?t:i.name}));for(var c=1;c<n.length;c++){if(!this.importing)return!1;if(n[0].length==n[c].length){var h={};for(var f in n[0])h[n[0][f]]=n[c][f];if(!(a=t.validate(h)))break;d.push(a)}else r--;o.find(".progress-bar").width(c/l*100+"%")}if(!a)return o.find(".btn").html("Done"),void o.find(".status").html('<div class="alert alert-danger">Error(s) in row '+c+", failed to validate!<ul><li>"+_.filter(t.errors,(function(e){return e.length})).join("</li><li>")+"</li></div>");for(o.find(".status").html("Adding Items..."),c=0;c<d.length;c++){if(!this.importing)return!1;t.add(d[c],{draw:!1}),o.find(".progress-bar").width((c+r)/l*100+"%")}o.find(".status").html('<div class="alert alert-success">Successfully processed file, '+r+" rows were added!</div>"),o.find(".btn").toggleClass("btn-danger btn-success").html("Done"),o.find(".progress").hide(),void 0!==t.options.sortBy&&(t.models=_.sortBy(t.models,function(e){return e.attributes[this.options.sortBy]}.bind(t)).reverse()),"function"==typeof t.options.onBulkLoad&&t.options.onBulkLoad()},n.onerror=function(e){"NotReadableError"==e.target.error.name&&alert("Canno't read file !")},i.currentTarget.value=""):alert("FileReader is not supported in this browser."),t.draw()}this.validate=function(t){var i=!1,s=new gform({collections:this.collections,fields:e.schema,attributes:t});return s.validate()?i=s.toJSON():(this.errors=s.errors,console.log("Model not valid")),s.destroy(),i},this.add=function(e,t){var i=new gridModel(this,e,{"*":[function(e){e.model.owner.eventBus.dispatch("model:"+e.event,e.model)}],check:[function(e){e.model.owner.draw()}]});return!(0!=t.validate&&!this.validate(e))&&(this.models.push(i),void 0!==this.options.sortBy&&(this.models=_.sortBy(this.models,function(e){return e.attributes[this.options.sortBy]}.bind(this)).reverse()),!1!==t.draw&&this.draw(),!0!==t.silent&&(this.eventBus.dispatch("created",i),this.eventBus.dispatch("model:created",i)),i)},this.search=function(e){var t=_.sortBy(this.getModels(),(function(t){return t.attributes[e.sort]}));e.reverse||(t=t.reverse()),filterMap=this.filterMap,t=_.filter(t,(function(t){var i=_.isEmpty(e.search);for(var s in e.search){if(!(i=_.filter(e.filterFields,{id:s})[0]&&void 0===_.filter(e.filterFields,{id:s})[0].options?_.score((t.display[this.filterMap[s]]+"").replace(/\s+/g," ").toLowerCase(),(e.search[s]+"").toLowerCase())>.4:t.display[this.filterMap[s]]+""==e.search[s]+""||t.attributes[this.filterMap[s]]+""==e.search[s]+""))break}return i})),this.lastGrabbed=t.length,this.filtered=t},this.find=function(e){var t=_.keys(e);return _.filter(this.getModels(),(function(i){return _.isEqual(e,_.pick(i.attributes,t))}))},this.searchAll=function(t){e.sort=null,this.$el.find("[data-sort]").removeClass("text-primary"),this.$el.find("[data-sort]").find("i").attr("class","fa fa-sort text-muted"),this.filter&&this.filter.set(),t=t.toLowerCase(),_.map(this.getModels(),(function(i){for(var s in i.score=0,e.filterFields)i.score+=_.score((i.display[e.filterFields[s].search]+"").replace(/\s+/g," ").toLowerCase(),t)})),this.filtered=_.filter(_.sortBy(this.getModels(),"score"),(function(e){return e.score>0})).reverse(),this.lastGrabbed=this.filtered.length},this.fixStyle=function(){if(this.options.autoSize)try{var e=this.$el.find(".table-container > div"),t=this.$el.find(".table-container > table tr th:visible"),i=this.$el.find(".list-group-row th");this.$el.find(".table-container table").removeClass("table-fixed"),e.css("width","auto"),e.css("minWidth","auto"),t.css("width","auto"),t.css("minWidth","85px"),this.$el.find(".table-container > table tr th.select-column").css("minWidth","60px"),this.$el.find(".table-container > table tr th.select-column").css("width","60px"),i.css("width","auto"),i.css("minWidth","auto"),e.css("height",$(window).height()-e.offset().top-(88+this.options.autoSize)+"px"),_.each(i,function(e,i){void 0!==t[i]?(e.style.display="table-cell",t[i].offsetWidth>e.offsetWidth?($(e).css("width",t[i].offsetWidth+"px"),$(e).css("minWidth",t[i].offsetWidth+"px"),$(t[i]).css("width",t[i].offsetWidth+"px"),$(t[i]).css("minWidth",t[i].offsetWidth+"px")):($(t[i]).css("width",t[i].offsetWidth+"px"),$(t[i]).css("minWidth",t[i].offsetWidth+"px"),$(e).css("width",t[i].offsetWidth+"px"),$(e).css("minWidth",t[i].offsetWidth+"px"))):e.style.display="none"}.bind(this)),this.$el.find(".table-container table").addClass("table-fixed");var s=this.$el.find(".table-container > div table")[0].offsetWidth;this.$el.find(".table-container > table")[0].offsetWidth>s&&(s=this.$el.find(".table-container > table")[0].offsetWidth),e.css("width",s+"px"),e.css("minWidth",s+"px"),s>this.$el.find(".table-container")[0].offsetWidth?this.$el.find(".table-container").css("overflow","auto"):this.$el.find(".table-container").css("overflow","hidden")}catch(e){}},this.visible=[],this.grab=function(e){_.each(this.visible,(function(e){e.visible=!1}));var t=this.filtered.slice(e.count*(e.page-1),e.count*(e.page-1)+e.count);return this.visible=t,_.each(this.visible,(function(e){e.visible=!0})),t},this.getModels=function(e){e=e||{deleted:!1};return _.filter(this.models,e)},this.getSelected=function(){return this.getModels({checked:!0,deleted:!1})},this.destroy=function(){this.$el.find(".list-group").empty(),this.$el.off(),this.$el.empty()},this.state={get:function(){var t={count:this.options.count,page:this.options.page};return this.$el.find('[name="search"]').length&&this.$el.find('[name="search"]').val().length?t.search=this.$el.find('[name="search"]').val():(t.sort=e.sort,t.reverse=e.reverse,void 0!==this.filter&&(t.filters={},_.each(this.options.filterFields,function(e){t.filters[e.search]=this[e.id]}.bind(this.filter.toJSON())))),t.columns=_.map(_.map(_.filter(this.summary.items,(function(e){return e.isEnabled})),"id"),function(e){return _.find(this.options.filterFields,{id:e}).search}.bind(this)),t}.bind(this),set:function(t){void 0!==t.columns&&t.columns.length&&(this.summary.items=_.map(this.summary.items,(function(e){return e.isEnabled=_.includes(t.columns,this.filterMap[e.cname]),e})),this.view=gform.renderString(e.item_template,o),this.$el.find('.columnEnables [type="checkbox"]').each((function(e){this.checked=!1})),e.columns&&_.each(t.columns,function(e){var t=this.$el.find('.columnEnables [data-field="'+_.find(this.options.filterFields,{search:e}).id+'"] [type="checkbox"]');t.length&&(t[0].checked=!0)}.bind(this))),void 0!==t.filters&&(this.filterValues={},_.each(t.filters,function(e,t){this.filterValues[_.find(this.options.filterFields,{search:t}).id]=e}.bind(this))),void 0!==t.sort&&n(t.sort||e.sort,t.reverse),void 0!==this.filter&&this.filter.set(this.filterValues),void 0!==t.search&&""!==t.search&&this.$el.find('[name="search"]').val(t.search),this.options.page=t.page||this.options.page,this.options.count=t.count||this.options.count,this.draw()}.bind(this)},this.models=[],this.options=e,this.filterMap={},_.map(e.filterFields,function(e){this.filterMap[e.id]=e.search}.bind(this)),this.getCSV=function(e){"string"!=typeof e&&(e=this.options.title),_.csvify(_.map(this.filtered,(function(e){return e.attributes})),_.map(_.filter(this.summary.items,(function(e){return e.isEnabled})),(function(e){return{label:e.label,name:this.filterMap[e.cname]}})),e)};var l=e.el;"string"==typeof e.el&&(l=document.querySelector(l)),null!==l&&(l.innerHTML=gform.renderString(a,o),function(i){this.$el=i,i.find(".filter").length&&(this.filter=new gform({actions:[],collections:this.collections,name:"filter"+this.options.id,clear:!1,fields:e.filterFields,default:{target:function(){return'[name="'+this.name+'"],[data-inline="'+this.name+'"]'},hideLabel:!0,type:"text",format:{label:"{{label}}",value:"{{value}}"}}},i.find(".filter")[0]).on("input",function(){this.$el.find('[name="search"]').val(""),this.filterValues=this.filter.toJSON(),this.draw()}.bind(this)),this.filter.set()),this.checkForm=new gform(_.assign({},{collections:this.collections,name:"internal"+this.options.id,fields:e.schema},e.form||{})).on("change",function(){_.each(this.models,(function(e){e.update(null,!0)}))}.bind(this)),this.updateCount=function(e){e=e||this.getSelected().length;this.summary.checked_count=e,this.mobile||this.$el.find('[name="actions"]').html(gform.render("actions",this.summary)),_.each(this.$el.find(".grid-action"),function(e){var t=_.assign({max:1e4,min:0},_.find(this.options.actions,{name:e.dataset.event}));this.summary.checked_count>=t.min&&this.summary.checked_count<=t.max?gform.removeClass(e,"disabled"):gform.addClass(e,"disabled")}.bind(this)),this.$el.find('[name="count"]').html(gform.render("count",this.summary));var t=this.$el.find('[name="select_all"].fa');e>0&&e==this.getModels().length?t.attr("class","fa fa-2x fa-check-square-o"):0==e?t.attr("class","fa fa-2x fa-square-o"):t.attr("class","fa fa-2x fa-minus-square-o")},this.load=function(e){if(_.each(this.models,(function(e){e.delete()})),this.models=[],e)for(var t in e)this.models.push(new gridModel(this,e[t],{"*":[function(e){e.model.owner.eventBus.dispatch("model:"+e.event,e.model)}],check:[function(e){e.model.owner.draw()}]}));void 0!==this.options.sortBy&&(this.models=_.sortBy(this.models,function(e){return e.attributes[this.options.sortBy]}.bind(this)).reverse()),this.draw()},this.view=gform.renderString(e.item_template,o),this.$el.on("change",".csvFileInput",_.partial(r,this)),this.$el.on("click",'[name="bt-upload"]',function(){this.$el.find(".csvFileInput").click()}.bind(this)),this.$el.on("click",'[name="bt-download"]',this.getCSV.bind(this)),this.$el.on("click","[data-page]",s.bind(this)),this.$el.on("click",".columnEnables label",function(t){t.stopPropagation(),_.find(this.summary.items,{id:t.currentTarget.dataset.field}).isEnabled=t.currentTarget.childNodes[0].checked,this.view=gform.renderString(e.item_template,o),this.draw()}.bind(this)),this.$el.on("click",".grid-row",function(e){this.eventBus.dispatch("click",_.find(this.models,{id:e.currentTarget.dataset.id}))}.bind(this)),this.$el.on("change",'[name="count"]',function(t){e.count=parseInt(t.currentTarget.value,10),this.draw()}.bind(this)),this.$el.on("input",'[name="search"]',_.debounce(function(e){this.draw()}.bind(this),300)),this.$el.on("click",'[name="select_all"]',function(e){var t=this.getSelected();t.length||0==this.getModels().length?_.each(t,(function(e){e.toggle(!1,!0)})):_.each(this.filtered,(function(e){e.toggle(!0,!0)})),this.draw()}.bind(this)),this.$el.on("click",'[name="reset-search"]',function(){this.$el.find('[name="search"]').val(""),this.filter&&this.filter.set(),this.filterValues={},n()}.bind(this)),this.dispatch=function(e,i){var s;void 0===i&&(i={event:e}),_.each(this.getSelected(),function(e){this.eventBus.dispatch("model:"+i.event,e)}.bind(this)),void 0!==i.id&&(s=_.find(this.models,{id:i.id}));var n=this.eventBus.dispatch(e,s,i);n.default&&void 0!==t[e]&&t[e].call(this,n)},this.$el.on("click","[data-event]",function(e){e.stopPropagation(),e.preventDefault();var t=_.assign({},e.currentTarget.dataset);this.dispatch(t.event,t)}.bind(this)),this.$el.on("click","[data-sort]",function(e){e.stopPropagation(),e.preventDefault();var t=_.find(this.options.filterFields,{name:e.currentTarget.dataset.sort}).search;this.options.reverse&&this.options.sort==t?n():n(t)}.bind(this)),this.$el.on("change",".sortBy",function(e){""!==e.currentTarget.value&&n((_.find(this.options.filterFields,{id:e.currentTarget.value})||{search:!0}).search)}.bind(this)),this.$el.on("click",".filterForm",function(t){this.$el.find('[name="search"]').val(""),new gform({collections:this.collections,legend:"Filter By",name:"modal_filter"+this.options.id,data:this.filterValues,fields:e.filterFields}).on("save",function(){this.filterValues=gform.instances["modal_filter"+this.options.id].toJSON(),this.draw(),gform.instances["modal_filter"+this.options.id].trigger("close")}.bind(this)).modal()}.bind(this)),this.$el.on("click",".reverse",function(e){n(this.options.sort)}.bind(this)),this.load(e.data)}.call(this,$(l))),this.$el.find('[name="search"]').focus(),this.$el.find(".table-container > div").css("overflow","auto"),$(window).on("resize orientationChange",this.fixStyle.bind(this)),i&&this.state.set(i)},GrapheneDataGrid.version="0.0.4.1";
_.mixin({score:function(t,e,r){if(r=r||0,0===e.length)return.9;if(e.length>t.length)return 0;for(var n=e.length;n>0;n--){var i=e.substring(0,n),o=t.indexOf(i);if(!(o<0)&&!(o+e.length>t.length+r)){var s=t.substring(o+i.length),a=null;a=n>=e.length?"":e.substring(n);var h=_.score(s,a,r+o);if(h>0){var l=t.length-s.length;if(0!==o){var u=t.charCodeAt(o-1);if(32==u||9==u)for(var c=o-2;c>=0;c--)l-=32==(u=t.charCodeAt(c))||9==u?1:.15;else l-=o}return l+=h*s.length,l/=t.length}}}return!1},csvToArray:function(t){for(var e=function(t){for(var e=0;e<t.length;e++)'"'==t[e][0]&&'"'==t[e][t[e].length-1]&&(t[e]=t[e].substr(1,t[e].length-2)),t[e]=t[e].split('""').join('"');return t},r=t.split(/\n/),n=e(r.shift().match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g)),i=[];r.length;){var o=e(r.shift().match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g)),s=_.zipObject(n,o);i.push(s)}return i},csvify:function(t,e,r){var n='"'+_.map(e,"label").join('","')+'"\n';labels=_.map(e,"name");var i=_.zipObject(labels,_.map(labels,(function(){return""})));n+=_.map(t,(function(t){return JSON.stringify(_.map(_.values(_.extend(i,_.pick(t,labels))),(function(t){return"string"==typeof t?t.split('"').join('""'):t})))}),this).join("\n").replace(/(^\[)|(\]$)/gm,"");var o=document.createElement("a");return o.setAttribute("href","data:text/csv;charset=utf-8,"+encodeURIComponent(n)),o.setAttribute("download",(r||"GrapheneDataGrid")+".csv"),document.body.appendChild(o),o.click(),document.body.removeChild(o),!0}});var CSVParser=function(){"use strict";function t(t){(!1===this.options.ignoreEmpty||t.some((function(t){return 0!==t.length})))&&this.rows.push(t)}function e(t,e){var r={fieldSeparator:",",strict:!0,ignoreEmpty:!0};void 0===e&&(e={}),this.options={},Object.keys(r).forEach((function(t){this.options[t]=void 0===e[t]?r[t]:e[t]}),this),this.rows=[],this.data=t}return e.prototype.toString=function(){return"[object CSVParser]"},e.prototype.numberOfRows=function(){return this.rows.length},e.prototype.parse=function(){for(var e,r,n="(\\"+this.options.fieldSeparator+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+this.options.fieldSeparator+"\\r\\n]*))",i=new RegExp(n,"gi"),o=new RegExp('""',"g"),s=[],a=null;a=i.exec(this.data);)(e=a[1]).length&&e!=this.options.fieldSeparator&&(t.apply(this,[s]),s=[]),r=a[2]?a[2].replace(o,'"'):a[3],s.push(r);if(t.apply(this,[s]),!0===this.options.strict&&!this.rows.every((function(t){return t.length===this.length}),this.rows[0]))throw new Error("Invalid CSV data. Strict mode requires all rows to have the same number of fields. You can override this by passing `strict: false` in the CSVParser options")},e}();
function gridModel(t,i,s){this.visible=!1,this.owner=t,this.id=gform.getUID(),this.attributes={},this.display={},this.attribute_history=[],this.schema=t.options.schema,this.iswaiting,this.row=document.createElement("tr"),this.row.setAttribute("data-id",this.id),this.row.setAttribute("class","filterable grid-row"+(this.iswaiting?" warning":"")),this.waiting=function(t){return void 0!==t&&(this.iswaiting=t,this.row.setAttribute("class","filterable grid-row"+(this.iswaiting?" warning":"")),this.draw()),this.iswaiting},this.draw=function(){if(this.visible){this.dispatch("draw");var t=gform.renderString(this.owner.view,this);this.row.innerHTML!=t&&(this.row.innerHTML=t),this.dispatch("drawn")}return this.row},this.eventBus=new gform.eventBus({owner:"model",item:"model",handlers:s||{}},this),this.on=this.eventBus.on,this.dispatch=this.eventBus.dispatch;var e=function(){_.each(this.schema,function(t){if(void 0!==t.options){var i=_.find(this.owner.checkForm.fields,{name:t.name}),s=_.find(i.mapOptions.getoptions(),{value:this.attributes[t.name]+""});void 0!==s?this.display[t.name]=s.label:(_.isFinite(this.attributes[t.name])&&(s=_.find(i.mapOptions.getoptions(),{value:parseInt(this.attributes[t.name])})),void 0!==s?this.display[t.name]=s.label:t.template?this.display[t.name]=gform.renderString(t.template,this):this.display[t.name]=this.attributes[t.name])}else t.template?this.display[t.name]=gform.renderString(t.template,this):this.display[t.name]=this.attributes[t.name]}.bind(this))};this.set=function(t,i){null!=t&&(this.attribute_history.push(_.extend({},this.attributes)),this.attributes=t),e.call(this),this.draw(),i||this.dispatch("set")},this.update=function(t,i){this.set(_.assign(this.attributes,t),i)},this.checked=!1,this.deleted=!1,this.toggle=function(t,i){this.checked="boolean"==typeof t?t:!this.checked,this.draw(),i||this.dispatch("check")},this.set(i),e.call(this),this.toJSON=function(){return this.attributes},this.undo=function(){this.deleted?(this.deleted=!1,this.owner.draw()):this.attribute_history.length&&(this.attributes=this.attribute_history.pop(),e.call(this),this.owner.draw())},this.delete=function(){this.deleted=!0}}
gform.stencils.actions='\n<table style="width:100%">\n<thead>\n<tr>\n<th>\n<div class="btn-group pull-left" style="white-space: nowrap; font-size: 0;" role="group" aria-label="...">\n\n{{#options.actions}}\n{{#name}}\n<a href="javascript:void(0);" style="display: inline-block;font-size: 14px;float: none;clear: none;" data-event="{{name}}" class="grid-action disabled btn btn-{{type}}{{^type}}default{{/type}}">{{{label}}}</a>\n{{/name}}\n\n{{^name}}\n</div>\n</th>\n<th style="width:100%">\n<div class="btn-group pull-{{^align}}left{{/align}}{{align}}" style="margin-left:15px;white-space: nowrap; font-size: 0;" role="group" aria-label="...">\n\n{{/name}}\n{{/options.actions}}\n</div>\n</th>\n</tr>\n</thead>\n</table>',gform.stencils.count='{{#checked_count}}<h5 class="range label label-info checked_count" style="margin:7px 0">{{checked_count}} item(s) selected</h5>{{/checked_count}}',gform.stencils.mobile_head='\n<div style="clear:both;">\n\n  {{#options.sort}}\n\n  <div class="row" style="margin-bottom:10px">\n\n    <div class="col-xs-6">\n    {{#options.filter}}\n\n      <div name="reset-search" style="position:relative" class="btn btn-default" data-toggle="tooltip" data-placement="left" title="Clear Filters">\n        <i class="fa fa-filter"></i>\n        <i class="fa fa-times text-danger" style="position: absolute;right: 5px;"></i>\n      </div>    \n\n    <div class="btn btn-info filterForm">Filter</div>\n  {{/options.filter}}\n    </div>\n    <div class="col-xs-6">\n    \t\t{{#options.search}}<input type="text" name="search" class="form-control" style="" placeholder="Search">{{/options.search}}\n        </div>\n    </div>\n    <div class="input-group">\n      <span class="" style="display: table-cell;width: 1%;white-space: nowrap;vertical-align: middle;padding-right:5px">\n        <button class="btn btn-default reverse" type="button" tabindex="-1"><i class="fa fa-sort text-muted"></i></button>\n      </span>\n        <select class="form-control sortBy">\n          <option value=true>None</option>\n          {{#items}}\n            {{#visible}}\n              <option value="{{id}}">{{label}}</option>\n            {{/visible}}\n          {{/items}}\n        <select>\n    </div>\n  {{/options.sort}}\n\n</div>\n',gform.stencils.mobile_row='<tr><td colspan="100%" class="filterable">\t\t\n{{^options.hideCheck}}\n\n<div data-event="mark" data-id="{{[[}}id{{]]}}"  style="text-align:left;padding:0;-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;">\n<span class="text-muted fa {{[[}}#iswaiting{{]]}}fa-spinner fa-spin {{[[}}/iswaiting{{]]}} {{[[}}^iswaiting{{]]}} {{[[}}#checked{{]]}}fa-check-square-o{{[[}}/checked{{]]}} {{[[}}^checked{{]]}}fa-square-o{{[[}}/checked{{]]}}{{[[}}/iswaiting{{]]}}" style="margin:6px; cursor:pointer;font-size:24px"></span>\n</div>\n  {{/options.hideCheck}}\n<div>\n{{#items}}\n{{#visible}}{{#isEnabled}}<div class="row" style="min-width:85px"><span class="col-sm-3"><b>{{label}}</b></span><span class="col-sm-9 col-xs-12">{{{name}}}</span></div>{{/isEnabled}}{{/visible}}\n{{/items}}\n</div>\n</td></tr>',gform.stencils.mobile_table='<div class="well table-well">\n<div style="height:40px;">\n  <div name="actions" class=" pull-left" style="margin-bottom:10px;width:62%" ></div>\n\n  <input type="file" class="csvFileInput" accept=".csv" style="display:none">\n\n  <div class="hiddenForm" style="display:none"></div>\n  <div class="btn-group pull-right" style="margin-bottom:10px" role="group" aria-label="...">\n    {{#showAdd}}\n    <div data-event="add" class="btn btn-success"><i class="fa fa-pencil-square-o"></i> New</div>\n    {{/showAdd}}\n\n    {{#options.actions}}\n      {{#global}}<div class="btn btn-default custom-event" data-event="{{name}}" data-id="{{[[}}id{{]]}}">{{{label}}}</div>{{/global}}\n    {{/options.actions}}\n    {{#options.download}}\n    <div class="btn btn-default hidden-xs" name="bt-download" data-toggle="tooltip" data-placement="left" title="Download"><i class="fa fa-download"></i></div>\n    {{/options.download}}\n    {{#options.upload}}\n    <div class="btn btn-default hidden-xs" name="bt-upload" data-toggle="tooltip" data-placement="left" title="Upload"><i class="fa fa-upload"></i></div>\n    {{/options.upload}}\n\n\n    {{#options.columns}}\n    <div class="btn-group columnEnables" data-toggle="tooltip" data-placement="left" title="Display Columns">\n      <button class="btn btn-default dropdown-toggle" type="button" id="enables_{{options.id}}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">\n        <i class="fa fa-list"></i>\n        <span class="caret"></span>\n      </button>\n      <ul class="dropdown-menu pull-right" style="padding-top:10px" aria-labelledby="enables_{{options.id}}">\n        {{#items}}\n        {{#visible}}\n        <li><label data-field="{{id}}" style="width:100%;font-weight:normal"><input type="checkbox" {{#isEnabled}}checked="checked"{{/isEnabled}} style="margin: 5px 0 5px 15px;"> {{label}}</label></li>\n        {{/visible}}\n        {{/items}}\n      </ul>\n    </div>\n    {{/options.columns}}\n\n  </div>\n\n\n</div>\t\n    {{>mobile_head}}\n\n\n{{^options.hideCheck}}\n<div style="padding: 16px 0 0 15px;"><i name="select_all" class="fa fa-2x fa-square-o"></i></div>\n{{/options.hideCheck}}\n\n<div class="table-container" style="width:100%;overflow:auto">\n\n<div style="min-height:100px">\n  <table class="table {{^options.noborder}}table-bordered{{/options.noborder}} table-striped table-hover dataTable" style="margin-bottom:0px">\n    <tbody class="list-group">\n      <tr><td colspan="100">\n        <div class="alert alert-info" role="alert">You have no items.</div>\n      </td></tr>\n    </tbody>\n\n  </table>\n</div>\n\n</div>\n<div class="paginate-footer" style="overflow:hidden;margin-top:10px"></div>\n</div>',gform.stencils.table='<div class="well table-well">\n<input type="file" class="csvFileInput" accept=".csv" style="display:none">\n<div class="hiddenForm" style="display:none"></div>\n\n<div style="overflow:hidden">\n  <div name="actions" class=" pull-left" style="margin-bottom:10px;" ></div>\n</div>\t\n<div>\n\n  <div class="btn-group pull-right" style="margin-bottom:10px;margin-left:10px" role="group" aria-label="...">\n\n    {{#options.download}}\n    <div class="btn btn-default hidden-xs" name="bt-download" data-toggle="tooltip" data-placement="left" title="Download"><i class="fa fa-download"></i></div>\n    {{/options.download}}\n    {{#options.upload}}\n    <div class="btn btn-default hidden-xs" name="bt-upload" data-toggle="tooltip" data-placement="left" title="Upload"><i class="fa fa-upload"></i></div>\n    {{/options.upload}}\n\n\n    {{#options.columns}}\n    <div class="btn-group columnEnables" data-toggle="tooltip" data-placement="left" title="Display Columns">\n      <button class="btn btn-default dropdown-toggle" type="button" id="enables_{{options.id}}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">\n        <i class="fa fa-list"></i>\n        <span class="caret"></span>\n      </button>\n      <ul class="dropdown-menu pull-right" style="padding-top:10px;padding-left:10px" aria-labelledby="enables_{{options.id}}">\n        {{#items}}\n        {{#visible}}\n        <li><label data-field="{{id}}" style="width:100%;font-weight:normal"><input type="checkbox" {{#isEnabled}}checked="checked"{{/isEnabled}}> {{label}}</label></li>\n        {{/visible}}\n        {{/items}}\n      </ul>\n    </div>\n    {{/options.columns}}\n  </div>\n  {{#options.search}}<input type="text" name="search" class="form-control pull-right" style="max-width:300px; margin-bottom:10px" placeholder="Search">{{/options.search}}\n\n  <span name="count"></span>\n</div>\n\n{{^options.autoSize}}\n<div class="paginate-footer hidden-xs" style="overflow:hidden;margin-top:10px;clear:both"></div>\n{{/options.autoSize}}\n\n<div class="table-container" style="width:100%;overflow:auto">\n{{#options.autoSize}}\n<table class="table {{^options.noborder}}table-bordered{{/options.noborder}}" style="margin-bottom:0px">\n<thead class="head">\n{{>table_head}}\n</thead>\n</table>\n{{/options.autoSize}}\n\n\n<div style="min-height:100px">\n  <table class="table {{^options.noborder}}table-bordered{{/options.noborder}} table-striped table-hover dataTable" style="margin-bottom:0px;{{#options.autoSize}}margin-top: -19px;{{/options.autoSize}}">\n    {{^options.autoSize}}\n    <thead class="head">\n    {{>table_head}}\n    </thead>\n    {{/options.autoSize}}\n{{#options.autoSize}}\n    <thead>\n          <tr  class="list-group-row">\n              {{^options.hideCheck}}\n  <th style="width:60px" class="select-column"></th>\n  {{/options.hideCheck}}\n        {{#items}}\n  {{#visible}}\n<th  style="min-width:85px">\n  {{/visible}}\n  {{/items}}\n  </tr>\n  </thead>\n{{/options.autoSize}}\n    <tbody class="list-group">\n      <tr><td colspan="100">\n        <div class="alert alert-info" role="alert">You have no items.</div>\n      </td></tr>\n    </tbody>\n\n  </table>\n</div>\n\n</div>\n<div class="paginate-footer" style="overflow:hidden;margin-top:10px"></div>\n</div>',gform.stencils.table_footer='<div>\n{{#multiPage}}\n<nav class="pull-right" style="margin-left: 10px;">\n{{#size}}\n  <ul class="pagination" style="margin:0">\n    {{^isFirst}}\n    {{^showFirst}}<li class="pagination-first"><a data-page="1" href="javascript:void(0);" aria-label="First"><span aria-hidden="true">&laquo;</span></a></li>{{/showFirst}}\n    <li><a data-page="dec" href="javascript:void(0);" aria-label="Previous"><span aria-hidden="true">&lsaquo;</span></a></li>\n    {{/isFirst}}\n    {{#pages}}\n      <li class="{{active}}"><a data-page="{{name}}" href="javascript:void(0);">{{name}}</a></li>\n    {{/pages}}\n    {{^isLast}}\n    <li><a data-page="inc" href="javascript:void(0);" aria-label="Next"><span aria-hidden="true">&rsaquo;</span></a></li>\n    {{^showLast}}<li class="pagination-last"><a data-page="" href="javascript:void(0);" aria-label="Last"><span aria-hidden="true">&raquo;</span></a></li>{{/showLast}}\n    {{/isLast}}\n\n  </ul>\n{{/size}}\n</nav>\n\n{{/multiPage}}\t\n<h5 class="range badge {{^size}}alert-danger{{/size}} pull-left" style="margin-right:15px;">{{#size}}Showing {{first}} to {{last}} of {{size}} results{{/size}}{{^size}}No matching results{{/size}}</h5>\n  {{#entries.length}}\n  <span class="pull-left">\n    <select class="form-control" style="display:inline-block;width:auto;min-width:50px" name="count">\n    <option value="10000">All</option>\n    {{#entries}}\n    <option value="{{value}}" {{#selected}}selected="selected"{{/selected}}>{{value}}</option>\n    {{/entries}}\n\n    </select>\n    <span class="hidden-xs">results per page</span>\n  </span>\n  {{/entries.length}}\n</div>',gform.stencils.table_head='  <tr style="cursor:pointer" class="noselect table-sort">\n{{^options.hideCheck}}\n<th style="width: 60px;min-width:60px;padding: 0 0 0 20px;" class="select-column"><i name="select_all" class="fa fa-2x fa-square-o"></i></th>\n{{/options.hideCheck}}\n\n{{#items}}\n{{#visible}}\n<th {{#options.sort}}data-sort="{{cname}}"{{/options.sort}}><h6 style="margin: 2px;font-size:13px;white-space: nowrap">{{#options.sort}}<i class="fa fa-sort text-muted"></i> {{/options.sort}}{{label}}</h6></th>\n{{/visible}}\n{{/items}}\n</tr>\n{{#options.filter}}\n<tr class="filter">\n{{^options.hideCheck}}<td>\n<div name="reset-search" style="position:relative" class="btn" data-toggle="tooltip" data-placement="left" title="Clear Filters">\n  <i class="fa fa-filter"></i>\n  <i class="fa fa-times text-danger" style="position: absolute;right: 5px;"></i>\n</div>\n</td>{{/options.hideCheck}}\n\n{{#items}}\n{{#visible}}\n<td data-inline="{{cname}}" style="min-width:85px" id="{{id}}"></td>\n{{/visible}}\n{{/items}}\n</tr>\n{{/options.filter}}',gform.stencils.table_row='{{^options.hideCheck}}\n\n<td data-event="mark" data-id="{{[[}}id{{]]}}" style="width: 60px;min-width:60px;text-align:left;padding:0;-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;">\n  <span class="text-muted fa {{[[}}#iswaiting{{]]}}fa-spinner fa-spin {{[[}}/iswaiting{{]]}} {{[[}}^iswaiting{{]]}} {{[[}}#checked{{]]}}fa-check-square-o{{[[}}/checked{{]]}} {{[[}}^checked{{]]}}fa-square-o{{[[}}/checked{{]]}}{{[[}}/iswaiting{{]]}} " style="margin:6px 0 6px 20px; cursor:pointer;font-size:24px"></span>\n   </td>\n\n  {{/options.hideCheck}}\n{{#items}}\n{{#visible}}{{#isEnabled}}<td style="min-width:85px">{{{name}}}</td>{{/isEnabled}}{{/visible}}\n{{/items}}';
